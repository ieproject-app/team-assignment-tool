<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Team Generator</title>
  <style>
    /* GLOBAL STYLES */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f7fa; color: #333; padding: 1rem; }
    h1 { text-align: center; margin-bottom: 1rem; font-size: 1.8rem; color: #2c3e50; }

    /* CONTAINER */
    #controls, #visual-output, #text-output, .instructions { max-width: 900px; margin: 0 auto; }
    #controls { background: #fff; padding: 1.5rem; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }

    /* FORM STYLES */
    .form-group { margin-bottom: 1rem; }
    label { display: block; margin-bottom: 0.5rem; font-weight: 600; color: #34495e; }
    input[type="number"], textarea, input[type="file"] {
      width: 100%; padding: 0.75rem; font-size: 0.95rem; border: 1px solid #ccd6dd; border-radius: 4px;
      transition: border-color 0.2s;
    }
    input[type="number"]:focus, textarea:focus, input[type="file"]:focus {
      border-color: #5d9cec;
      outline: none;
    }

    /* BUTTONS */
    .btn { display: inline-block; padding: 0.6rem 1.2rem; font-size: 0.9rem; font-weight: 600; border: none; border-radius: 4px; cursor: pointer; transition: background 0.2s, transform 0.1s; text-decoration: none; color: #fff; }
    .btn-primary { background: #3498db; }
    .btn-primary:hover { background: #2980b9; }
    .btn-secondary { background: #7f8c8d; }
    .btn-secondary:hover { background: #606b6e; }
    .btn + .btn { margin-left: 0.5rem; }
    .btn:active { transform: scale(0.98); }

    /* VISUAL OUTPUT GRID */
    #visual-output { display: grid; gap: 1rem; margin-top: 1.5rem; }
    .team-card { background: #fff; border-radius: 6px; padding: 1rem; box-shadow: 0 1px 4px rgba(0,0,0,0.1); font-size: 0.85rem; }
    .team-card h3 { margin-bottom: 0.5rem; font-size: 1.1rem; color: #2c3e50; }
    .team-card ul { list-style: none; }
    /* RESPONSIVE GRID */
    @media (min-width: 700px) {
      #visual-output { grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); }
    }
    @media (max-width: 699px) {
      #visual-output { grid-template-columns: 1fr 1fr; }
    }

    /* TEXT OUTPUT */
    #text-output { margin-top: 1.5rem; background: #fff; padding: 1rem; border-radius: 6px; font-family: monospace; font-size: 0.9rem; line-height: 1.4; box-shadow: 0 1px 4px rgba(0,0,0,0.1); white-space: pre-wrap; }

    /* INSTRUCTIONS */
    .instructions { margin-top: 1.5rem; background: #ecf0f1; padding: 1rem; border-radius: 6px; font-size: 0.9rem; color: #2c3e50; }
    .instructions ol { padding-left: 1.2rem; }
    .instructions li { margin-bottom: 0.5rem; }
  </style>
</head>
<body>
  <h1>Team Generator</h1>

  <!-- INPUT FORM -->
  <div id="controls">
    <div class="form-group">
      <label for="numTeams">Jumlah Tim (kosong = auto)</label>
      <input type="number" id="numTeams" placeholder="3" min="1" />
    </div>
    <div class="form-group">
      <label for="perTeam">Anggota per Tim (default 6)</label>
      <input type="number" id="perTeam" value="6" min="1" />
    </div>
    <div class="form-group">
      <label for="names">Daftar Nama (satu per baris)</label>
      <textarea id="names" rows="6" placeholder="Nama 1\nNama 2\n..."></textarea>
    </div>
    <div class="form-group">
      <label for="importNames">Import .txt/.json</label>
      <input type="file" id="importNames" accept=".txt, .json" />
    </div>
    <button class="btn btn-primary" id="generateBtn">Generate</button>
    <button class="btn btn-secondary" id="copyBtn">Copy to Clipboard</button>
    <button class="btn btn-secondary" id="exportJsonBtn">Export JSON</button>
    <button class="btn btn-secondary" id="exportTxtBtn">Export TXT</button>
  </div>

  <!-- VISUAL OUTPUT -->
  <div id="visual-output"></div>

  <!-- TEXT OUTPUT -->
  <div id="text-output"></div>

  <!-- INSTRUCTIONS -->
  <div class="instructions">
    <strong>Cara Salin ke Excel:</strong>
    <ol>
      <li>Klik tombol "Copy to Clipboard"</li>
      <li>Buka Excel, lalu Paste (Ctrl + V)</li>
      <li>Gunakan font <em>Consolas</em> agar struktur rapi</li>
      <li>Untuk data tabular, gunakan fitur <em>Text to Columns</em></li>
    </ol>
  </div>

  <script>
    // Utility: read file input
    document.getElementById('importNames').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        const ext = file.name.split('.').pop().toLowerCase();
        let content = reader.result;
        if (ext === 'json') {
          try {
            const obj = JSON.parse(content);
            let lines = [];
            obj.teams.forEach(t => lines.push(...t.members));
            document.getElementById('names').value = lines.join('\n');
          } catch (err) { alert('Gagal parse JSON'); }
        } else {
          document.getElementById('names').value = content;
        }
      };
      reader.readAsText(file);
    });

    document.getElementById('generateBtn').addEventListener('click', () => {
      const raw = document.getElementById('names').value.trim();
      let names = raw.split(/\r?\n/).filter(n => n.trim());
      const perTeam = parseInt(document.getElementById('perTeam').value)||6;
      let numTeams = parseInt(document.getElementById('numTeams').value);
      if (!numTeams || numTeams < 1) numTeams = Math.floor(names.length / perTeam) || 1;
      let teams = Array.from({ length: numTeams }, () => []);
      names.forEach((n, i) => teams[i % numTeams].push(n));
      // handle overflow
      let extras = [];
      teams.forEach((arr, idx) => { if (arr.length > perTeam) extras.push(...arr.splice(perTeam)); });
      extras.forEach(name => { teams.sort((a,b)=>a.length-b.length)[0].push(name); });
      // merge small
      teams = teams.filter(team => {
        if (team.length < 5 && teams.length > 1) {
          teams.sort((a,b)=>b.length-a.length);
          teams[0].push(...team);
          return false;
        }
        return true;
      });
      renderOutput(teams);
    });

    function renderOutput(teams) {
      const grid = document.getElementById('visual-output');
      grid.innerHTML = '';
      teams.forEach((members, i) => {
        const card = document.createElement('div'); card.className = 'team-card';
        let html = `<h3>Tim ${i+1}</h3><ul>`;
        members.forEach(m=> html += `<li>${m}</li>`);
        html += '</ul>';
        card.innerHTML = html;
        grid.appendChild(card);
      });
      const txtDiv = document.getElementById('text-output');
      let txt = '';
      teams.forEach((members, i) => {
        txt += `Tim ${i+1}\n`;
        members.forEach(m=> txt += `- ${m}\n`);
        txt += '\n';
      });
      txtDiv.textContent = txt.trim();
    }

    // Copy and export
    document.getElementById('copyBtn').addEventListener('click', () => {
      navigator.clipboard.writeText(document.getElementById('text-output').textContent)
        .then(()=> alert('Teks berhasil disalin ke clipboard'));
    });
    document.getElementById('exportJsonBtn').addEventListener('click', () => {
      const teams = parseTextOutput();
      download(JSON.stringify({ teams: teams.map((m,i)=>({ name: `Tim ${i+1}`, members: m })) }, null, 2), 'teams.json', 'application/json');
    });
    document.getElementById('exportTxtBtn').addEventListener('click', () => {
      download(document.getElementById('text-output').textContent, 'teams.txt', 'text/plain');
    });

    function parseTextOutput() {
      return document.getElementById('text-output').textContent.split(/\r?\n/)
        .reduce((res, line) => {
          if (line.startsWith('Tim')) res.push([]);
          else if (line.startsWith('- ')) res[res.length-1].push(line.slice(2));
          return res;
        }, []);
    }
    function download(content, filename, type) {
      const blob = new Blob([content], { type });
      const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = filename;
      a.click(); URL.revokeObjectURL(a.href);
    }
  </script>
</body>
</html>
