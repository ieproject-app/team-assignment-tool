<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Generator</title>
    <style>
        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --border-color: #dee2e6;
            --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
        }

        body {
            font-family: var(--font-family);
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: var(--light-color);
            color: var(--dark-color);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            background-color: #fff;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            max-width: 1000px;
            width: 100%;
            margin-bottom: 20px;
        }

        h1, h2 {
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        input[type="number"],
        textarea {
            width: calc(100% - 20px);
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            font-size: 1rem;
            box-sizing: border-box;
        }

        textarea {
            min-height: 150px;
            resize: vertical;
        }

        input[type="file"] {
            margin-top: 5px;
        }

        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
            justify-content: center;
        }

        button {
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: background-color 0.3s ease;
        }

        button.primary {
            background-color: var(--primary-color);
            color: white;
        }

        button.primary:hover {
            background-color: #0056b3;
        }

        button.secondary {
            background-color: var(--secondary-color);
            color: white;
        }

        button.secondary:hover {
            background-color: #5a6268;
        }

        button.success {
            background-color: var(--success-color);
            color: white;
        }

        button.success:hover {
            background-color: #218838;
        }

        button.warning {
            background-color: var(--warning-color);
            color: var(--dark-color);
        }

        button.warning:hover {
            background-color: #e0a800;
        }

        .error-message {
            color: var(--danger-color);
            margin-top: 10px;
            text-align: center;
            font-weight: bold;
        }

        .output-section {
            margin-top: 30px;
            border-top: 1px solid var(--border-color);
            padding-top: 20px;
        }

        .team-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 20px;
            overflow: auto; /* Allow scroll for too many teams, but try to fit */
            max-height: 60vh; /* Limit height to prevent excessive scrolling on small screens */
            padding-bottom: 10px; /* Space for scrollbar */
        }

        .team-column {
            border: 1px solid var(--border-color);
            border-radius: 5px;
            padding: 10px 5px;
            background-color: var(--light-color);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column;
        }

        .team-column h3 {
            margin-top: 0;
            margin-bottom: 8px;
            color: var(--primary-color);
            font-size: 0.9em;
            text-align: center;
            padding-bottom: 5px;
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            background-color: var(--light-color); /* To make header visible when scrolling */
            z-index: 1;
        }

        .team-member {
            font-size: 0.8em;
            padding: 2px 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .text-output-container {
            margin-top: 30px;
        }

        #excelOutput {
            width: 100%;
            min-height: 200px;
            background-color: var(--dark-color);
            color: var(--light-color);
            padding: 15px;
            border-radius: 5px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9em;
            white-space: pre-wrap;
            word-wrap: break-word;
            overflow-x: auto;
        }

        .copy-instructions {
            margin-top: 15px;
            font-size: 0.9em;
            background-color: #e9ecef;
            padding: 10px;
            border-radius: 5px;
            border-left: 5px solid var(--primary-color);
        }

        .copy-instructions strong {
            color: var(--primary-color);
        }

        /* Mobile adjustments */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            h1 {
                font-size: 1.8em;
            }

            .button-group {
                flex-direction: column;
            }

            button {
                width: 100%;
            }

            .team-grid {
                grid-template-columns: 1fr; /* Stack teams vertically on small screens */
                max-height: unset; /* Allow full height scroll on mobile if needed */
            }

            .team-column h3 {
                position: static; /* Remove sticky header on mobile for better flow */
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Team Generator</h1>

        <div class="form-group">
            <label for="numTeams">Number of Teams:</label>
            <input type="number" id="numTeams" value="3" min="1">
        </div>

        <div class="form-group">
            <label for="membersPerTeam">Members Per Team (max 7):</label>
            <input type="number" id="membersPerTeam" value="6" min="1" max="7">
        </div>

        <div class="form-group">
            <label for="nameList">List of Names (one per line):</label>
            <textarea id="nameList" placeholder="Nama1&#10;Nama2&#10;Nama3"></textarea>
        </div>

        <div class="form-group">
            <label for="importFile">Import Names from .txt file:</label>
            <input type="file" id="importFile" accept=".txt">
        </div>

        <div class="button-group">
            <button class="primary" id="generateTeams">Generate Teams</button>
            <button class="secondary" id="importAssignment">Import Assignment (JSON/TXT)</button>
            <input type="file" id="importAssignmentFile" accept=".json,.txt" style="display: none;">
        </div>

        <div id="errorMessage" class="error-message" style="display: none;"></div>
    </div>

    <div class="container output-section" id="outputSection" style="display: none;">
        <h2>Team Assignments</h2>
        <div class="team-grid" id="teamGrid">
            </div>

        <div class="text-output-container">
            <h3>Text Output (for Excel)</h3>
            <pre id="excelOutput"></pre>
            <div class="button-group">
                <button class="success" id="copyToClipboard">Copy to Clipboard</button>
                <button class="warning" id="exportAssignment">Export Assignment (JSON)</button>
                <button class="warning" id="exportAssignmentTxt">Export Assignment (TXT)</button>
            </div>
            <div class="copy-instructions">
                > **How to copy to Excel:**<br>
                > 1. Click "Copy to Clipboard"<br>
                > 2. Open Excel â†’ Paste (Ctrl + V)<br>
                > 3. Choose font **Consolas** for neat alignment<br>
                > 4. Use *Text to Columns* if needed
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const numTeamsInput = document.getElementById('numTeams');
        const membersPerTeamInput = document.getElementById('membersPerTeam');
        const nameListTextarea = document.getElementById('nameList');
        const importFile = document.getElementById('importFile');
        const generateTeamsButton = document.getElementById('generateTeams');
        const errorMessageDiv = document.getElementById('errorMessage');
        const outputSection = document.getElementById('outputSection');
        const teamGrid = document.getElementById('teamGrid');
        const excelOutput = document.getElementById('excelOutput');
        const copyToClipboardButton = document.getElementById('copyToClipboard');
        const exportAssignmentButton = document.getElementById('exportAssignment');
        const exportAssignmentTxtButton = document.getElementById('exportAssignmentTxt');
        const importAssignmentButton = document.getElementById('importAssignment');
        const importAssignmentFile = document.getElementById('importAssignmentFile');

        let generatedTeams = []; // Store the current generated teams

        // Event Listeners
        generateTeamsButton.addEventListener('click', generateTeams);
        importFile.addEventListener('change', handleImportFile);
        copyToClipboardButton.addEventListener('click', copyExcelOutputToClipboard);
        exportAssignmentButton.addEventListener('click', () => exportAssignment('json'));
        exportAssignmentTxtButton.addEventListener('click', () => exportAssignment('txt'));
        importAssignmentButton.addEventListener('click', () => importAssignmentFile.click());
        importAssignmentFile.addEventListener('change', handleImportAssignmentFile);

        /**
         * Reads names from textarea or imported file.
         * @returns {Array<string>} An array of names.
         */
        function getNames() {
            let names = nameListTextarea.value.split('\n')
                                            .map(name => name.trim())
                                            .filter(name => name !== '');
            return [...new Set(names)]; // Remove duplicates
        }

        /**
         * Handles the import of names from a .txt file.
         * @param {Event} event The change event from the file input.
         */
        function handleImportFile(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    nameListTextarea.value = e.target.result;
                    displayMessage('Names imported successfully!', 'success');
                };
                reader.onerror = () => {
                    displayMessage('Error reading file.', 'danger');
                };
                reader.readAsText(file);
            }
        }

        /**
         * Displays an error or success message.
         * @param {string} message The message to display.
         * @param {string} type The type of message ('success' or 'danger').
         */
        function displayMessage(message, type = 'danger') {
            errorMessageDiv.textContent = message;
            errorMessageDiv.style.display = 'block';
            errorMessageDiv.style.color = type === 'success' ? var_success_color : var_danger_color;
            setTimeout(() => {
                errorMessageDiv.style.display = 'none';
            }, 5000);
        }

        /**
         * Shuffles an array in place (Fisher-Yates algorithm).
         * @param {Array} array The array to shuffle.
         * @returns {Array} The shuffled array.
         */
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        /**
         * Generates teams based on input parameters.
         */
        function generateTeams() {
            const names = shuffleArray(getNames());
            const totalNames = names.length;
            let numTeams = parseInt(numTeamsInput.value);
            const membersPerTeam = parseInt(membersPerTeamInput.value);

            if (isNaN(numTeams) || numTeams < 1) {
                displayMessage('Number of teams must be at least 1.');
                return;
            }
            if (isNaN(membersPerTeam) || membersPerTeam < 1 || membersPerTeam > 7) {
                displayMessage('Members per team must be between 1 and 7.');
                return;
            }
            if (totalNames === 0) {
                displayMessage('Please enter names or import a file.');
                return;
            }

            // Calculate ideal total capacity
            const idealTotalCapacity = numTeams * membersPerTeam;

            // Adjust number of teams if total names exceed ideal capacity
            if (totalNames > idealTotalCapacity) {
                numTeams = Math.ceil(totalNames / membersPerTeam);
                displayMessage(`Total names (${totalNames}) exceed initial capacity. Adjusting to ${numTeams} teams.`, 'warning');
            }

            let teams = Array.from({ length: numTeams }, (_, i) => ({
                name: `Tim ${i + 1}`,
                members: []
            }));

            let nameIndex = 0;
            // Distribute names evenly first
            for (let i = 0; i < totalNames; i++) {
                teams[i % numTeams].members.push(names[nameIndex++]);
            }

            // Handle remaining members if some teams exceed max capacity (due to even distribution)
            // This scenario happens if membersPerTeam is small and numTeams is large, with many people.
            // We ensure no team exceeds 7, and re-distribute.
            let redistributionNeeded = true;
            while(redistributionNeeded) {
                redistributionNeeded = false;
                for (let i = 0; i < teams.length; i++) {
                    while (teams[i].members.length > membersPerTeam) {
                        const excessMember = teams[i].members.pop();
                        // Find a team that can take an extra member without exceeding 7, preferring smaller teams
                        let assigned = false;
                        for (let j = 0; j < teams.length; j++) {
                            const targetTeamIndex = (i + 1 + j) % teams.length; // Cycle through teams
                            if (teams[targetTeamIndex].members.length < 7) { // Max 7 members
                                teams[targetTeamIndex].members.push(excessMember);
                                assigned = true;
                                redistributionNeeded = true;
                                break;
                            }
                        }
                        if (!assigned) {
                             // If no existing team can take, create a new team for the excess member
                             const newTeamName = `Tim ${teams.length + 1}`;
                             teams.push({ name: newTeamName, members: [excessMember] });
                             redistributionNeeded = true;
                        }
                    }
                }
            }


            // Final check: if remaining people < 5, spread them out to existing teams (up to max 7)
            // This is handled by the above redistribution logic more broadly.
            // The constraint of spreading remaining < 5 to existing teams up to max 7
            // implies that we prioritize filling existing teams before creating new ones if possible.
            // Our current loop already does this by attempting to place in other teams before creating new.
            // The 'if !assigned' part is the "create new team if necessary" fallback.

            // Ensure all names are processed
            const processedNamesCount = teams.reduce((acc, team) => acc + team.members.length, 0);
            if (processedNamesCount !== totalNames) {
                displayMessage(`Error: Mismatch in total names. Expected ${totalNames}, processed ${processedNamesCount}. Please check input.`);
                return;
            }

            generatedTeams = teams;
            renderTeams(teams);
            renderExcelOutput(teams);
            outputSection.style.display = 'block';
            displayMessage('Teams generated successfully!', 'success');
        }

        /**
         * Renders the teams in a visual grid format.
         * @param {Array<Object>} teams The array of team objects.
         */
        function renderTeams(teams) {
            teamGrid.innerHTML = ''; // Clear previous teams
            teams.forEach(team => {
                const teamColumn = document.createElement('div');
                teamColumn.classList.add('team-column');

                const teamHeader = document.createElement('h3');
                teamHeader.textContent = team.name;
                teamColumn.appendChild(teamHeader);

                team.members.forEach(member => {
                    const memberDiv = document.createElement('div');
                    memberDiv.classList.add('team-member');
                    memberDiv.textContent = member;
                    teamColumn.appendChild(memberDiv);
                });
                teamGrid.appendChild(teamColumn);
            });
        }

        /**
         * Renders the teams in a text format suitable for Excel.
         * @param {Array<Object>} teams The array of team objects.
         */
        function renderExcelOutput(teams) {
            let outputText = '';
            teams.forEach(team => {
                outputText += `${team.name}:\n`;
                team.members.forEach(member => {
                    outputText += `- ${member}\n`;
                });
                outputText += '\n'; // Add an empty line between teams for better readability in Excel
            });
            excelOutput.textContent = outputText.trim(); // Trim last empty line
        }

        /**
         * Copies the Excel output text to the clipboard.
         */
        function copyExcelOutputToClipboard() {
            navigator.clipboard.writeText(excelOutput.textContent)
                .then(() => displayMessage('Copied to clipboard!', 'success'))
                .catch(err => displayMessage('Failed to copy to clipboard.', 'danger'));
        }

        /**
         * Exports the generated assignment as JSON or TXT file.
         * @param {string} format The export format ('json' or 'txt').
         */
        function exportAssignment(format) {
            if (generatedTeams.length === 0) {
                displayMessage('No teams generated to export.', 'danger');
                return;
            }

            let data;
            let filename;
            let mimeType;

            if (format === 'json') {
                data = JSON.stringify({ teams: generatedTeams }, null, 2);
                filename = 'team_assignment.json';
                mimeType = 'application/json';
            } else if (format === 'txt') {
                data = excelOutput.textContent; // Use the same format as Excel output
                filename = 'team_assignment.txt';
                mimeType = 'text/plain';
            }

            const blob = new Blob([data], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            displayMessage(`Assignment exported as ${filename}!`, 'success');
        }

        /**
         * Handles the import of an assignment from a JSON or TXT file.
         * @param {Event} event The change event from the file input.
         */
        function handleImportAssignmentFile(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const content = e.target.result;
                    if (file.name.endsWith('.json')) {
                        const importedData = JSON.parse(content);
                        if (importedData.teams && Array.isArray(importedData.teams)) {
                            generatedTeams = importedData.teams;
                            renderTeams(generatedTeams);
                            renderExcelOutput(generatedTeams);
                            outputSection.style.display = 'block';
                            displayMessage('Assignment imported from JSON successfully!', 'success');
                        } else {
                            throw new Error('Invalid JSON format for assignment.');
                        }
                    } else if (file.name.endsWith('.txt')) {
                        // For TXT, we parse it back into teams assuming the Excel output format
                        const lines = content.split('\n').map(line => line.trim()).filter(line => line !== '');
                        let currentTeam = null;
                        let teams = [];
                        lines.forEach(line => {
                            if (line.endsWith(':')) {
                                const teamName = line.slice(0, -1);
                                currentTeam = { name: teamName, members: [] };
                                teams.push(currentTeam);
                            } else if (line.startsWith('- ') && currentTeam) {
                                currentTeam.members.push(line.substring(2));
                            }
                        });
                        generatedTeams = teams;
                        renderTeams(generatedTeams);
                        renderExcelOutput(generatedTeams);
                        outputSection.style.display = 'block';
                        displayMessage('Assignment imported from TXT successfully!', 'success');
                    }
                } catch (error) {
                    displayMessage(`Error importing assignment: ${error.message}`, 'danger');
                }
            };
            reader.onerror = () => {
                displayMessage('Error reading imported assignment file.', 'danger');
            };
            reader.readAsText(file);
        }
    </script>
</body>
</html>
