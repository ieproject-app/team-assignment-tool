<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Team Generator</title>
  <style>
    /* GLOBAL RESET */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: sans-serif; padding: 1rem; }
    h1 { text-align: center; margin-bottom: 1rem; }

    /* FORM STYLES */
    .form-group { margin-bottom: 0.75rem; }
    label { display: block; margin-bottom: 0.25rem; font-weight: bold; }
    input[type="number"], textarea, input[type="file"], select { width: 100%; padding: 0.5rem; font-size: 0.9rem; }
    button { padding: 0.5rem 1rem; margin-right: 0.5rem; cursor: pointer; }

    /* OUTPUT VISUAL GRID */
    #visual-output { display: grid; gap: 0.5rem; margin-top: 1rem; }
    .team-card { border: 1px solid #ccc; border-radius: 4px; padding: 0.5rem; font-size: 0.75rem; }
    .team-card h3 { margin-bottom: 0.25rem; font-size: 0.85rem; }

    /* TEXT OUTPUT */
    #text-output { margin-top: 1rem; background: #f9f9f9; padding: 0.5rem; font-family: monospace; font-size: 0.85rem; white-space: pre-wrap; }

    /* INSTRUCTIONS */
    .instructions { margin-top: 1rem; font-size: 0.85rem; background: #eef; padding: 0.5rem; border-radius: 4px; }

    /* RESPONSIVE GRID */
    @media (min-width: 600px) {
      #visual-output { grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); }
    }
    @media (max-width: 599px) {
      #visual-output { grid-template-columns: repeat(auto-fit, minmax(80px, 1fr)); }
    }
  </style>
</head>
<body>
  <h1>Team Generator</h1>

  <!-- INPUT FORM -->
  <div id="controls">
    <div class="form-group">
      <label for="numTeams">Jumlah Tim (kosong = auto)</label>
      <input type="number" id="numTeams" placeholder="3" min="1" />
    </div>
    <div class="form-group">
      <label for="perTeam">Anggota per Tim (default 6)</label>
      <input type="number" id="perTeam" value="6" min="1" />
    </div>
    <div class="form-group">
      <label for="names">Daftar Nama (satu per baris)</label>
      <textarea id="names" rows="6" placeholder="Nama 1\nNama 2\n..."></textarea>
    </div>
    <div class="form-group">
      <label for="importNames">Import .txt/.json</label>
      <input type="file" id="importNames" accept=".txt, .json" />
    </div>
    <button id="generateBtn">Generate</button>
    <button id="copyBtn">Copy to Clipboard</button>
    <button id="exportJsonBtn">Export JSON</button>
    <button id="exportTxtBtn">Export TXT</button>
  </div>

  <!-- VISUAL OUTPUT -->
  <div id="visual-output"></div>

  <!-- TEXT OUTPUT -->
  <div id="text-output"></div>

  <!-- INSTRUCTIONS -->
  <div class="instructions">
    <strong>Cara Salin ke Excel:</strong>
    <ol>
      <li>Klik tombol "Copy to Clipboard"</li>
      <li>Buka Excel, lalu Paste (Ctrl + V)</li>
      <li>Gunakan font <em>Consolas</em> agar struktur rapi</li>
      <li>Untuk data tabular, gunakan fitur <em>Text to Columns</em></li>
    </ol>
  </div>

  <script>
    // Utility: read file input
    document.getElementById('importNames').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        const ext = file.name.split('.').pop().toLowerCase();
        let content = reader.result;
        if (ext === 'json') {
          try {
            const obj = JSON.parse(content);
            let lines = [];
            obj.teams.forEach(t => lines.push(...t.members));
            document.getElementById('names').value = lines.join('\n');
          } catch (err) { alert('Gagal parse JSON'); }
        } else {
          document.getElementById('names').value = content;
        }
      };
      reader.readAsText(file);
    });

    document.getElementById('generateBtn').addEventListener('click', () => {
      const raw = document.getElementById('names').value.trim();
      let names = raw.split(/\r?\n/).filter(n => n.trim());
      const perTeam = parseInt(document.getElementById('perTeam').value)||6;
      let numTeams = parseInt(document.getElementById('numTeams').value);
      // auto-calc if not set
      if (!numTeams || numTeams < 1) {
        numTeams = Math.floor(names.length / perTeam) || 1;
      }
      let teams = [];
      // initial fill
      for (let i = 0; i < numTeams; i++) teams.push([]);
      // assign
      names.forEach((n, i) => {
        const idx = i % numTeams;
        teams[idx].push(n);
      });
      // handle overflow: if any team > perTeam, create extras
      let extras = [];
      teams = teams.map(arr => {
        if (arr.length > perTeam) {
          extras.push(...arr.splice(perTeam));
        }
        return arr;
      });
      // distribute extras
      extras.forEach(name => {
        // find team with < perTeam+1 or smallest
        teams.sort((a,b)=> a.length - b.length);
        teams[0].push(name);
      });
      // merge small remainders (<5) if new team size<5
      teams = teams.filter(team => {
        if (team.length < 5 && teams.length > 1) {
          // merge into the largest
          teams.sort((a,b)=> b.length - a.length);
          teams[0].push(...team);
          return false;
        }
        return true;
      });

      renderOutput(teams);
    });

    function renderOutput(teams) {
      // Visual
      const grid = document.getElementById('visual-output');
      grid.innerHTML = '';
      teams.forEach((members, i) => {
        const card = document.createElement('div');
        card.className = 'team-card';
        let html = `<h3>Tim ${i+1}</h3><ul>`;
        members.forEach(m=> html += `<li>${m}</li>`);
        html += '</ul>';
        card.innerHTML = html;
        grid.appendChild(card);
      });
      // Text
      const txtDiv = document.getElementById('text-output');
      let txt = '';
      teams.forEach((members, i) => {
        txt += `Tim ${i+1}\n`;
        members.forEach(m=> txt += `- ${m}\n`);
        txt += '\n';
      });
      txtDiv.textContent = txt.trim();
    }

    // copy to clipboard
    document.getElementById('copyBtn').addEventListener('click', () => {
      const txt = document.getElementById('text-output').textContent;
      navigator.clipboard.writeText(txt).then(()=> alert('Disalin ke clipboard')); 
    });

    // export JSON
    document.getElementById('exportJsonBtn').addEventListener('click', () => {
      const teams = parseTextOutput();
      const data = { teams: teams.map((m,i)=> ({ name: `Tim ${i+1}`, members: m })) };
      download(JSON.stringify(data, null, 2), 'teams.json', 'application/json');
    });

    // export TXT
    document.getElementById('exportTxtBtn').addEventListener('click', () => {
      const txt = document.getElementById('text-output').textContent;
      download(txt, 'teams.txt', 'text/plain');
    });

    function parseTextOutput() {
      const lines = document.getElementById('text-output').textContent.split(/\r?\n/);
      let teams = [], cur = null;
      lines.forEach(line => {
        if (line.startsWith('Tim')) {
          cur = [];
          teams.push(cur);
        } else if (line.startsWith('- ')) {
          cur && cur.push(line.slice(2));
        }
      });
      return teams;
    }

    function download(content, filename, type) {
      const blob = new Blob([content], { type });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = filename;
      a.click();
      URL.revokeObjectURL(a.href);
    }
  </script>
</body>
</html>
